sequenceDiagram
    participant F as 前端 Frontend
    participant W as WebSocket 服务
    participant M as MTS Service
    participant S as Sportradar MTS

    Note over F,S: 场景：用户在单关模式下批量提交多个单注

    F->>F: 用户为 3 个选项输入金额<br/>点击"下单"按钮
    F->>F: (禁用下单按钮，显示加载状态)
    F->>W: 发送批量投注请求<br/>type: place_bet<br/>requestId: xxx<br/>betType: multi<br/>oddsChangePreference: accept_any<br/>payload: {bets: [bet1, bet2, bet3]}

    W->>W: 验证请求格式
    alt 验证失败
        W-->>F: 返回错误<br/>type: bet_error
        F->>F: 显示错误提示, 启用下单按钮
    else 验证成功
        W-->>F: 确认接收<br/>type: bet_received<br/>requestId: xxx
        F->>F: 界面保持"处理中..."

        W->>M: 调用 POST /api/bets/multi
        M->>S: 发送包含多个 bet 的 Ticket

        Note over M,S: MTS 一次性处理所有 bet

        S-->>M: 返回包含多个结果的 Response
        M-->>W: 推送最终结果

        W-->>F: 推送最终结果<br/>type: bet_result<br/>requestId: xxx<br/>summary: {accepted: 2, rejected: 1}<br/>details: [...]
        F->>F: 显示汇总结果<br/>清空成功的投注<br/>保留失败的投注<br/>更新余额, 启用下单按钮
    end

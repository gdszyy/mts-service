# MTS 前端交互逻辑设计 v3 (细节完善版)

本文档在 v2 版本的基础上，进一步完善了 MTS 前端交互逻辑的细节，重点解决了模式切换时的金额处理、快捷金额选项、设置页面设计以及异常情况处理等关键问题，旨在提供更精细、更用户友好的投注体验。

## 1. 模式切换时的金额处理逻辑

在“单关”和“串关”模式之间切换时，投注金额的保留和转换是提升用户体验的关键。我们应遵循以下原则：

### 1.1. 从“单关模式”切换到“串关模式”

1.  **金额清空**：当从“单关模式”切换到“串关模式”时，所有在单关模式下为每个选项输入的独立金额应被**清空**。
2.  **原因**：单关模式下的金额是针对每个独立投注的，而串关模式（包括系统投注和 Banker 投注）通常是针对整个组合或单位投注的。两种模式的金额逻辑不兼容，强制转换容易导致用户混淆或错误。
3.  **用户提示**：在切换前，应弹出一个确认框，提示用户“切换到串关模式将清空所有单关投注金额，是否继续？”。

### 1.2. 从“串关模式”切换到“单关模式”

1.  **金额清空**：当从“串关模式”切换到“单关模式”时，串关模式下输入的总金额或单位金额应被**清空**。
2.  **原因**：同上，串关模式的金额逻辑与单关模式不兼容。
3.  **用户提示**：在切换前，应弹出一个确认框，提示用户“切换到单关模式将清空所有串关投注金额，是否继续？”。

### 1.3. 模式内切换（例如：串关模式内从“串关”子标签页切换到“系统”子标签页）

1.  **金额保留/转换**：
    -   如果从“串关”子标签页切换到“系统”子标签页，且用户之前在“串关”中输入了总金额，则该金额不应自动转换为“系统”投注的单位金额，而应清空。
    -   反之亦然。
2.  **原因**：即使在同一大模式下，不同子模式的金额逻辑也可能不同（总金额 vs 单位金额），清空可以避免误操作。
3.  **用户提示**：在切换前，应有提示告知用户金额将被清空。

## 2. 快捷金额选项

为了提高投注效率，应在金额输入框下方或旁边提供一组预设的快捷金额按钮。

-   **位置**：金额输入框下方或旁边。
-   **预设值**：例如：`+5`, `+10`, `+20`, `+50`, `+100`, `Max`。
-   **交互**：
    -   点击 `+X` 按钮，将 `X` 金额累加到当前输入框的值中。
    -   点击 `Max` 按钮，将当前可用余额（或根据用户设置的最大投注限额）填充到输入框中。
-   **可配置性**：快捷金额的预设值应在“设置页面”中允许用户自定义。

## 3. 设置页面设计

一个独立的“设置页面”将允许用户根据个人偏好定制投注体验。

### 3.1. 赔率展示方式

-   **选项**：
    -   **小数赔率 (Decimal Odds)**：例如 `2.50` (默认)
    -   **分数赔率 (Fractional Odds)**：例如 `5/2`
    -   **美式赔率 (American Odds)**：例如 `+150`
-   **交互**：用户选择后，所有赔率显示应实时更新。

### 3.2. 接受赔率变化的方式

-   **选项**：
    -   **不接受任何变化 (Do not accept any odds changes)**：当赔率发生变化时，投注单会提示用户，需要手动确认才能提交。
    -   **接受任何变化 (Accept any odds changes)**：赔率变化时自动接受，无需用户确认。
    -   **只接受更高赔率 (Accept higher odds only)**：赔率提高时自动接受，赔率降低时提示用户确认。
-   **交互**：用户选择后，系统在提交投注时将根据此设置处理赔率变化。

### 3.3. 快捷金额自定义

-   **功能**：允许用户自定义快捷金额按钮的预设值（例如，`+5`, `+10` 等）。
-   **交互**：提供输入框或加减按钮，让用户添加、修改或删除快捷金额。

### 3.4. 其他设置 (可选)

-   **默认投注模式**：用户登录后默认进入单关模式还是串关模式。
-   **自动清空投注单**：投注成功后是否自动清空投注单。
-   **通知偏好**：异步通知的显示方式（弹窗、消息中心等）。

## 4. 异常情况下的展示

清晰、及时的异常提示对于用户理解问题和采取行动至关重要。

### 4.1. 赔率变化

-   **场景**：用户在选择选项后，但在提交投注前，赔率发生变化。
-   **展示**：
    -   受影响的赔率应高亮显示（例如，红色闪烁或变色）。
    -   在投注单顶部或受影响选项旁边显示提示信息：“赔率已更新，请确认。”
    -   根据用户在设置中选择的“接受赔率变化方式”进行处理。

### 4.2. 选项失效/不可用

-   **场景**：用户选择的选项因赛事开始、盘口关闭、取消等原因而失效。
-   **展示**：
    -   失效选项应变灰或显示删除线，并附带明确的提示信息（例如，“赛事已开始”、“盘口已关闭”）。
    -   自动将失效选项从投注单中移除，并提示用户。
    -   如果所有选项都失效，则清空投注单并提示。

### 4.3. 余额不足

-   **场景**：用户尝试投注的金额超过其可用余额。
-   **展示**：
    -   在金额输入框下方显示红色错误信息：“余额不足。”
    -   “投注”按钮应禁用或显示为“充值”按钮。

### 4.4. API 错误

-   **场景**：提交投注后，API 返回 4xx/5xx 错误。
-   **展示**：
    -   在投注单顶部或错误信息区域显示清晰的错误提示，例如：“投注失败：[错误信息]”。
    -   如果错误是临时的（如网络问题），建议用户重试。
    -   如果错误是业务逻辑问题（如投注规则不符），则保留投注单内容，并高亮显示问题所在。

### 4.5. 网络连接问题

-   **场景**：前端与后端失去连接。
-   **展示**：
    -   在页面顶部显示一个全局的警告条：“网络连接不稳定，请检查您的网络设置。”
    -   投注按钮应禁用，直到网络恢复。

---

## 5. 总结

通过对这些细节的完善，`mts-service` 的前端交互将更加健壮和人性化。这些改进将显著提升用户在投注过程中的体验，减少误操作，并提供清晰的反馈机制。

# MTS 前端交互逻辑设计草案

本文档旨在为 `mts-service` 设计一套完整、高效且用户友好的前端交互逻辑。逻辑围绕着核心组件 **“投注单” (Bet Slip)** 展开，并覆盖所有 MTS 支持的投注场景。

## 1. 核心设计理念

- **动态与响应式**: 投注单是所有交互的核心。它应根据用户添加或移除的选项动态更新，并自动显示所有可用的投注类型。
- **清晰与直观**: 用户应能清晰地理解不同投注类型之间的区别，以及他们的选择如何影响最终的投注组合与潜在回报。
- **原子化操作**: 每个用户操作（如添加选项、输入金额）都应是独立的，并立即在界面上反馈结果，避免复杂的多步骤表单。
- **API 驱动**: 前端交互应与 `mts-service` 的 API 端点设计紧密对齐，确保数据流的顺畅与一致性。

## 2. 投注场景与交互逻辑

### 2.1. 核心流程：构建投注单

这是所有投注场景的起点。

1.  **用户浏览赛事**: 用户在赛事列表或详情页浏览不同的盘口和赔率。
2.  **选择盘口**: 用户点击一个或多个赔率，将其添加到投注单中。
3.  **投注单更新**: 
    -   每当一个选项被添加或移除，投注单组件都会更新其内部状态。
    -   前端根据投注单中的选项数量，动态渲染可用的投注类型标签页（例如：单注、串关、系统）。
    -   如果一个选项已被选中，再次点击应将其从投注单中移除。
    -   已选中的选项在赛事列表中应有高亮或特殊标记。

### 2.2. 场景一：单注 (Single Bet)

- **触发条件**: 投注单中只有 **1** 个选项。
- **前端交互**:
    1.  投注单默认显示 **“单注”** 视图。
    2.  用户在此选项旁边输入投注金额。
    3.  界面实时计算并显示预计返还金额（金额 × 赔率）。
    4.  用户点击“投注”按钮。
- **API 调用**: `POST /api/bets/single`

### 2.3. 场景二：串关 (Accumulator / Multiple)

- **触发条件**: 投注单中有 **2 个或以上**的选项。
- **前端交互**:
    1.  投注单出现 **“串关”** (或“多重彩”) 标签页。
    2.  用户切换到此标签页。
    3.  界面显示总赔率（所有选项赔率的乘积）。
    4.  用户输入一个总的投注金额。
    5.  界面实时计算并显示预计总返还金额。
    6.  用户点击“投注”按钮。
- **API 调用**: `POST /api/bets/accumulator`

### 2.4. 场景三：系统投注 (System Bet)

- **触发条件**: 投注单中有 **3 个或以上**的选项。
- **前端交互**:
    1.  投注单出现 **“系统”** 标签页。
    2.  用户切换到此标签页。
    3.  界面根据选项数量，动态生成所有可能的系统投注组合。例如，4 个选项会显示：
        -   二串一 (Doubles) (6 注)
        -   三串一 (Trebles) (4 注)
        -   四串一 (Four-fold) (1 注)
        -   预设系统：Yankee (11 注)
    4.  用户可以为**每种组合**输入**单位投注金额**。
    5.  界面根据用户输入的单位金额，实时计算每种组合的总金额和总投注额。
    6.  用户点击“投注”按钮。
- **API 调用**: 
    -   对于自定义组合（如仅投二串一），调用 `POST /api/bets/system`。
    -   对于预设系统（如 Yankee），调用 `POST /api/bets/preset`。

### 2.5. 场景四：Banker 系统投注 (Banker System Bet)

- **触发条件**: 在“系统”投注标签页内，且投注单中有 **3 个或以上**的选项。
- **前端交互**:
    1.  在系统投注视图的每个选项旁边，提供一个 **“B”** (Banker) 复选框或按钮。
    2.  当用户将一个或多个选项标记为 Banker 后：
        -   界面上被标记为 Banker 的选项应有特殊高亮。
        -   动态更新可用的系统投注组合。例如，在一个 4 选项的投注中，如果 1 个被设为 Banker，则系统组合变为基于另外 3 个非 Banker 选项的组合（如：二串一 (3 注)）。
    3.  用户为更新后的系统组合输入单位投注金额。
    4.  用户点击“投注”按钮。
- **API 调用**: `POST /api/bets/banker-system`

## 3. 投注提交流程

1.  **构建请求**: 用户点击“投注”后，前端根据当前激活的投注场景和用户输入，构建对应的 API 请求体。
2.  **禁用按钮**: 在请求发送期间，禁用“投注”按钮，并显示加载状态，防止重复提交。
3.  **处理响应**:
    -   **成功 (HTTP 200)**: 
        -   显示成功提示（如 “投注已接受”）。
        -   清空投注单。
        -   可以选择性地显示一个包含 `ticketId` 和投注详情的收据。
    -   **失败 (HTTP 4xx/5xx)**: 
        -   显示清晰的错误信息（例如，从 API 响应的 `error.message` 和 `error.details` 中获取）。
        -   **不要清空投注单**，以便用户可以修正问题（如金额不足、选项已失效）后重新提交。

## 4. 异步更新与通知

- **票据状态**: 投注成功后，前端应能通过 WebSocket 或轮询机制，根据 `ticketId` 异步接收票据的最终状态（如 `settled`, `won`, `lost`）。
- **用户通知**: 当票据状态更新时，应通过一个不打扰用户流程的通知系统（如右上角的小弹窗）告知用户结果。


# MTS 前端交互逻辑设计

**版本**: 1.0  
**日期**: 2025-12-01  
**作者**: Manus AI

---

## 1. 概述

本文档为 `mts-service` 设计了一套完整、高效且用户友好的前端交互逻辑。该逻辑以核心组件 **“投注单” (Bet Slip)** 为中心，全面覆盖了 MTS (Managed Trading Services) 支持的所有主要投注场景。其目的是为前端开发团队提供清晰的指引，确保最终产品具有卓越的用户体验和稳健的技术实现。

### 1.1. 核心设计理念

我们的设计遵循以下四个核心原则：

-   **动态与响应式**: 投注单是所有交互的核心。它应根据用户添加或移除的选项动态更新，并自动显示所有可用的投注类型。
-   **清晰与直观**: 用户应能清晰地理解不同投注类型之间的区别，以及他们的选择如何影响最终的投注组合与潜在回报。
-   **原子化操作**: 每个用户操作（如添加选项、输入金额）都应是独立的，并立即在界面上反馈结果，避免复杂的多步骤表单。
-   **API 驱动**: 前端交互应与 `mts-service` 的 API 端点设计紧密对齐，确保数据流的顺畅与一致性。

### 1.2. 核心组件：投注单 (Bet Slip)

投注单是整个前端交互的枢纽。它不仅是用户选择的容器，更是动态生成投注选项、计算赔率和引导用户完成投注的核心界面。

![投注单核心交互流程](flowcharts/bet_slip_core_flow.png)

**图 1：投注单核心交互流程图**

如上图所示，投注单根据用户添加的选项数量，动态地展示不同的投注标签页（单注、串关、系统），从而引导用户进入不同的投注场景。

---

## 2. 投注场景与交互逻辑

以下部分详细阐述了每个投注场景的触发条件、前端交互流程、对应的 API 调用以及流程图。

### 2.1. 场景一：单注 (Single Bet)

单注是最基础的投注类型，即对单个赛事的单个结果进行投注。

-   **触发条件**: 投注单中仅包含 **1** 个选项。
-   **前端交互**:
    1.  投注单默认显示 **“单注”** 视图。
    2.  用户在选项旁边清晰可见的输入框中输入投注金额。
    3.  界面根据输入的金额和该选项的赔率，实时计算并显示预计返还金额。
    4.  用户点击“投注”按钮，触发提交流程。
-   **API 调用**: `POST /api/bets/single`

![单注投注流程](flowcharts/single_bet_flow.png)

**图 2：单注投注流程图**

### 2.2. 场景二：串关 (Accumulator / Multiple)

串关是将多个选项组合成一个单一的投注，所有选项必须全部猜中才能获胜。

-   **触发条件**: 投注单中包含 **2 个或以上**的选项。
-   **前端交互**:
    1.  投注单顶部出现 **“串关”** (或“多重彩”) 标签页。
    2.  用户切换到此标签页后，界面会显示一个总赔率（所有选项赔率的乘积）。
    3.  用户在单一的金额输入框中输入总投注金额。
    4.  界面根据总金额和总赔率，实时计算并显示预计总返还金额。
    5.  用户点击“投注”按钮。
-   **API 调用**: `POST /api/bets/accumulator`

![串关投注流程](flowcharts/accumulator_bet_flow.png)

**图 3：串关投注流程图**

### 2.3. 场景三：系统投注 (System Bet)

系统投注允许用户在多个选项中组合出多种串关，即使有选项猜错，仍有机会赢得部分奖金。

-   **触发条件**: 投注单中包含 **3 个或以上**的选项。
-   **前端交互**:
    1.  投注单顶部出现 **“系统”** 标签页。
    2.  用户切换到此标签页后，界面会根据选项数量，动态生成所有可能的系统投注组合（例如，4 个选项会显示二串一、三串一、四串一以及预设的 Yankee）。
    3.  用户可以为**每种组合**（如“二串一 (6 注)”）输入**单位投注金额**。
    4.  界面根据用户输入的单位金额，实时计算每种组合的总金额，并累加为总投注额。
    5.  用户点击“投注”按钮。
-   **API 调用**:
    -   对于自定义组合（如仅投二串一），调用 `POST /api/bets/system`。
    -   对于预设系统（如 Yankee），调用 `POST /api/bets/preset`。

![系统投注流程](flowcharts/system_bet_flow.png)

**图 4：系统投注流程图**

### 2.4. 场景四：Banker 系统投注 (Banker System Bet)

Banker 系统投注是系统投注的变体，用户可以指定一个或多个“胆”（Banker），这些“胆”必须猜中，才会计算剩余选项的组合奖金。

-   **触发条件**: 在“系统”投注标签页内，且投注单中有 **3 个或以上**的选项。
-   **前端交互**:
    1.  在系统投注视图的每个选项旁边，提供一个清晰的 **“B”** (Banker) 复选框或按钮。
    2.  当用户将一个或多个选项标记为 Banker 后，界面会立即响应：
        -   被标记为 Banker 的选项应有特殊高亮或标记，以示区分。
        -   系统会根据剩余的非 Banker 选项，动态地重新计算并显示可用的系统投注组合。
    3.  用户为更新后的系统组合输入单位投注金额。
    4.  用户点击“投注”按钮。
-   **API 调用**: `POST /api/bets/banker-system`

![Banker 系统投注流程](flowcharts/banker_system_bet_flow.png)

**图 5：Banker 系统投注流程图**

---

## 3. 通用流程

### 3.1. 投注提交流程

无论何种投注场景，提交流程都应保持一致，以提供可预测的用户体验。

1.  **构建请求**: 用户点击“投注”后，前端根据当前激活的投注场景和用户输入，构建对应的 API 请求体。
2.  **禁用按钮**: 在请求发送期间，禁用“投注”按钮并显示加载状态（如旋转图标），以防止重复提交。
3.  **处理响应**:
    -   **成功 (HTTP 200)**: 显示一个清晰、积极的成功提示（如 “投注已接受”），然后清空投注单，并可以选择性地为用户显示一个包含 `ticketId` 和投注详情的收据。
    -   **失败 (HTTP 4xx/5xx)**: 显示具体的错误信息（从 API 响应的 `error.message` 和 `error.details` 中获取），并且**不要清空投注单**，以便用户可以修正问题（如金额不足、选项已失效）后重新提交。

### 3.2. 异步更新与通知

为了提供实时的投注结果反馈，前端需要实现异步更新机制。

-   **票据状态**: 投注成功后，前端应能通过 WebSocket 或定时轮询机制，根据 `ticketId` 异步接收票据的最终状态（如 `settled`, `won`, `lost`）。
-   **用户通知**: 当票据状态更新时，应通过一个不打扰用户当前流程的通知系统（如屏幕右上角的小弹窗）告知用户结果，增强用户参与感。

---

## 4. 结论

本设计方案为 `mts-service` 的前端开发提供了一套全面、详细的交互逻辑和流程。通过以“投注单”为核心，动态响应用户操作，并为不同投注场景提供清晰、直观的界面，我们可以构建一个既符合 MTS 技术要求，又具备出色用户体验的现代化体育投注平台。建议开发团队以此文档为基础，结合具体的设计规范和技术栈，进行详细的界面设计和功能实现。

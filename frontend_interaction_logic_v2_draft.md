---

# MTS 前端交互逻辑设计 v2 (用户反馈优化版)

本文档根据用户反馈进行优化，旨在提供一套更贴近主流体育投注平台用户习惯的前端交互逻辑。新逻辑以 **“单关” (Single)** 和 **“串关” (Multi)** 两种核心模式为基础，重构了投注单 (Bet Slip) 的交互流程。

## 1. 核心设计变更：模式切换

投注单的顶部应提供一个清晰、醒目的模式切换器（例如，Toggle Switch 或标签页），允许用户在 **“单关”** 和 **“串关”** 两种模式之间自由切换。这个选择将从根本上改变投注单的行为和最终的 API 请求结构。

## 2. 投注场景与交互逻辑 (v2)

### 2.1. 核心流程：构建投注单

1.  **用户浏览赛事与盘口**：用户点击赔率，将选项添加到投注单。
2.  **投注单更新**：选项被添加后，投注单会更新。**无论添加多少选项，投注单始终保持用户最后选择的模式（单关或串关）**。

### 2.2. 模式一：单关 (Single Mode)

此模式下，所有投注都被视为独立的单注。

-   **触发条件**: 用户将投注单模式切换到 **“单关”**。
-   **前端交互**:
    1.  无论投注单中有多少个选项，每个选项都会被视为一个独立的投注单位。
    2.  每个选项旁边都有一个**独立的金额输入框**。
    3.  用户可以为任意数量的选项输入投注金额。
    4.  界面会分别计算每个选项的预计返还金额，并计算所有已输入金额的选项的总投注额。
    5.  用户点击“投注”按钮。
-   **API 调用**: `POST /api/bets/multi`
    -   请求体中的 `bets` 数组将包含多个 `BetDefinition` 对象。
    -   每个 `BetDefinition` 的 `type` 都是 `"single"`，并包含对应的 `selection` 和 `stake`。

### 2.3. 模式二：串关 (Multi Mode)

此模式下，所有选项都被视为一个组合，可以进行串关、系统或 Banker 系统投注。

-   **触发条件**: 用户将投注单模式切换到 **“串关”**。
-   **前端交互**:
    1.  当用户切换到此模式，界面会聚合所有选项，并根据选项数量提供不同的组合投注方式。
    2.  **子场景会以标签页或折叠面板的形式呈现**，例如：
        -   **串关 (Accumulator)**: 默认显示。将所有 N 个选项组合成一个 N 串 1 的投注。
        -   **系统 (System)**: 当选项 ≥ 3 个时可用。显示所有可能的系统组合（如二串一、三串一、Yankee 等）。
        -   **Banker**: 在“系统”视图内提供，允许用户将某些选项设为“胆”。

#### 2.3.1. 子场景：串关 (Accumulator)

-   **界面**: 显示一个总赔率（所有选项赔率的乘积）和一个**单一的总金额输入框**。
-   **API 调用**: `POST /api/bets/accumulator`

#### 2.3.2. 子场景：系统投注 (System Bet)

-   **界面**: 
    1.  列出所有可用的系统组合（例如，4 个选项会显示：二串一 (6 注)、三串一 (4 注)、Yankee (11 注)）。
    2.  用户可以为**每种组合**输入**单位投注金额**。
    3.  界面实时计算并显示总投注额。
-   **API 调用**: 
    -   自定义组合: `POST /api/bets/system`
    -   预设系统: `POST /api/bets/preset`

#### 2.3.3. 子场景：Banker 系统投注 (Banker System Bet)

-   **界面**: 
    1.  在系统投注的每个选项旁边，提供一个 **“B”** (Banker) 复选框。
    2.  当用户标记 Banker 后，系统组合列表会**动态更新**，只显示基于非 Banker 选项的组合。
    3.  用户为更新后的组合输入单位投注金额。
-   **API 调用**: `POST /api/bets/banker-system`

## 3. 投注提交流程 (v2)

提交流程保持不变，但 API 请求的构建逻辑会根据用户选择的模式（单关/串关）和子场景（串关/系统/Banker）而有所不同。

-   **单关模式**: 构建一个包含多个 `type: "single"` 的 `multi` bet 请求。
-   **串关模式**: 根据用户选择的子场景，构建 `accumulator`, `system`, `preset`, 或 `banker-system` 请求。


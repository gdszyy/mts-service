flowchart TD
    Start([用户浏览赛事]) --> ClickOdds{用户点击赔率}
    
    ClickOdds --> CheckExist{选项已在投注单?}
    CheckExist -->|是| RemoveSelection[从投注单中移除选项]
    CheckExist -->|否| AddSelection[添加选项到投注单]
    
    RemoveSelection --> UpdateUI1[更新界面：移除高亮]
    AddSelection --> UpdateUI2[更新界面：添加高亮]
    
    UpdateUI1 --> UpdateBetSlip[更新投注单状态]
    UpdateUI2 --> UpdateBetSlip
    
    UpdateBetSlip --> CountSelections{计算选项数量}
    
    CountSelections -->|0 个| EmptyState[显示空投注单提示]
    CountSelections -->|1 个| ShowSingle[显示单注标签页]
    CountSelections -->|2 个| ShowAccum[显示单注 + 串关标签页]
    CountSelections -->|≥ 3 个| ShowAll[显示单注 + 串关 + 系统标签页]
    
    ShowSingle --> RenderTabs1[渲染标签页]
    ShowAccum --> RenderTabs2[渲染标签页]
    ShowAll --> RenderTabs3[渲染标签页]
    
    RenderTabs1 --> WaitUserAction[等待用户操作]
    RenderTabs2 --> WaitUserAction
    RenderTabs3 --> WaitUserAction
    EmptyState --> WaitUserAction
    
    WaitUserAction --> UserAction{用户操作}
    UserAction -->|添加/移除选项| ClickOdds
    UserAction -->|切换标签页| SwitchTab[切换到对应投注场景]
    UserAction -->|输入金额| UpdateAmount[更新金额并重新计算]
    UserAction -->|点击投注| SubmitBet[提交投注]
    
    SwitchTab --> RenderScenario[渲染对应场景的界面]
    RenderScenario --> WaitUserAction
    
    UpdateAmount --> RecalcPayout[重新计算预计返还]
    RecalcPayout --> DisplayPayout[更新显示]
    DisplayPayout --> WaitUserAction
    
    SubmitBet --> BetFlow[进入对应投注场景的提交流程]
    BetFlow --> End([结束或返回投注单])
    
    style Start fill:#4CAF50,stroke:#2E7D32,color:#fff
    style End fill:#F44336,stroke:#C62828,color:#fff
    style UpdateBetSlip fill:#2196F3,stroke:#1565C0,color:#fff
    style ShowSingle fill:#9C27B0,stroke:#6A1B9A,color:#fff
    style ShowAccum fill:#9C27B0,stroke:#6A1B9A,color:#fff
    style ShowAll fill:#9C27B0,stroke:#6A1B9A,color:#fff
    style SubmitBet fill:#4CAF50,stroke:#2E7D32,color:#fff
    style AddSelection fill:#00BCD4,stroke:#00838F,color:#fff
    style RemoveSelection fill:#FF9800,stroke:#E65100,color:#fff
    style CountSelections fill:#FFC107,stroke:#F57C00,color:#000
